<div class="container">
  <div class="row">
    <%= form_with(model: @order, url: orders_path, method: :post, local: true) do |f| %>
      <section class="inner">
        <h3>注文情報確認</h3>
        <table class= "table table table-bordered border-dark">
          <thead>
            <tr scope="col" class="table-active">
              <td>商品名</td>
              <td>単価(税込み)</td>
              <td>数量</td>
              <td>小計</td>
            </tr>
          </thead>
          <tbody>
            <% @sum = 0%>
            <% @cart_items.each do |cart_item|%>
            <tr>
              <td><%= cart_item.item.name %></td>
              <td><%= cart_item.item.with_tax_price.to_s %></td>
              <td><%= cart_item.amount %></td>
              <td><%= cart_item.item.with_tax_price.to_i * cart_item.amount.to_i %></td>
              <% @sum += cart_item.item.with_tax_price.to_i * cart_item.amount.to_i %>
            </tr>
            <% end %>
          </tbody>
        </table>
      </section>
      <section>
        <table class= "table table table-bordered mt-5">
          <tr>
            <td>送料</td>
            <td><%= @order.shipping_cost %></td>
          </tr>
          <tr>
            <td>商品合計</td>
            <td><%= @sum %></td>
          </tr>
          <tr>
            <td>請求金額</td>
            <td><%= @order.shipping_cost + @sum %></td>
          </tr>
        </table>
      </section>
        <table class = "table table-bordered w-50 mx-auto">
          <tr>
            <th scope="col" class="table-active">支払方法</th>
              <td scope="col">
              <% if @order.payment_method == 1 %>
                <span>カード</span>
              <% else %>
                <span>銀行振込</span>
              <% end %>
              </td>
            </th>
          </tr>
          <tr>
            <th scope="col" class="table-active">
            お届け先
              <td scope="col">
                〒<%= @order.postal_code %> <%= @order.address%><br>
                <%= @order.name %>
              </td>
            </th>
          </tr>
        </table>
        <%= f.hidden_field :customer_id, :value => current_customer.id %>
        <%= f.hidden_field :postal_code, :value => @order.postal_code %>
        <%= f.hidden_field :address, :value => @order.address %>
        <%= f.hidden_field :name, :value => @order.name %>
        <%= f.hidden_field :shipping_cost, :value => @order.shipping_cost %>
        <%= f.hidden_field :total_payment, :value => @sum %>
        <%= f.hidden_field :payment_method, :value => @order.payment_method %>
        <%= f.hidden_field :status, :value => @order.status %>
        <div class="action"><br>
          <%= f.submit "注文を確定する", class: "btn btn-success", data: {confirm: "注文を確定してよろしいですか？"} %>
        </div>
    <% end %>
  </div>
</div>